# システム設計

<!-- MarkdownTOC -->

- Web推薦システムの構成
- ユビキタス言語
- ドメインモデル
- ビジネスロジック
    - 類似アイテム取得API\(素性ベースレコメンド\)
    - ユーザベースレコメンドAPI\(協調フィルタリングレコメンド\)
    - スコアリングバッチ
- クラス図
    - レコメンドAPIコンテキスト
    - スコアリングバッチコンテキスト
- シーケンス図

<!-- /MarkdownTOC -->


## Web推薦システムの構成

<img src="./imgs/一般的なウェブ推薦システムの構成.png">

 - <strong>推薦サービス</strong> : ウェブサーバからの推薦要求を受け取り、推薦アイテムを返す
    - <strong>アイテム検索器</strong> : 各リクエストに対して、アイテム検索器はユーザID$i$を使用してユーザデータストアに問い合わせ、ユーザ素性ベクトル$\vec {x}_{i}$および潜在因子ベクトル$\vec {u}_{i}$を得る。ユーザ素性ベクトルにもとづいてアイテム検索器はアイテムインデックスを照会し、ユーザに対する候補アイテムセットを取得する。必要に応じて単純な基準またはモデルを使用して、インデックスから返される候補アイテムを上位$k$個に限定して、計算コストを減らすことができる。次に候補アイテムは、ユーザ素性ベクトルおよび因子とともにランク器(ranker)に送信される。
    - <strong>ランク器</strong> : ユーザ$i$の候補アイテムを受け取ると、ランク器は各アイテム$j$の推定応答率の平均と分散を計算する。平均は${\vec {x}}^{\prime}_{i} {\bf A} {\vec {x}}_{j} + {\vec {u}}^{\prime}_{i} \vec {\upsilon}_{j}$の単純関数である。最後に、全ての候補アイテムの応答率の平均および/または分散に基づいて探索-活用戦略が適用され、アイテムに対する「飢餓(starvation)」(サンプルが全くない状態)を回避し、ユーザにとって最良のアイテムに迅速に収束するようにする。
 - <strong>ストレージシステム</strong> : ユーザ素性ベクトル(および潜在因子)、アイテム素性ベクトル(および潜在因子)、モデルパラメータおよびアイテムの効率的な検索システムのためのインデックスを格納する
    - <strong>アイテムインデックス</strong> : この例では、アイテム挿入器は多数のアイテム供給元を監視する。そして、新しいアイテム$j$が利用可能になると、アイテム挿入器はアイテム素性ベクトル$x_{j}$を抽出し、アイテムおよびその素性ベクトルをアイテムインデックスに入れ、素性ベクトルによるアイテムの迅速な検索をサポートする
    - <strong>ユーザデータストア</strong> : ユーザ素性ベクトル$x_{i}$は、ユーザデータストアに格納される。ユーザデータストアは、指定されたキー(ユーザID)による値(ユーザ素性ベクトル)の高速取得をサポートするように設計されたKeyValueストアである。
 - <strong>オフライン学習器</strong> : ユーザ応答データからモデルパラメータ(および潜在因子)を学習し、パラメータ(および因子)をオンラインストレージシステムに定期的(毎日など)にプッシュする。通常、モデルの学習には時間がかかる。特にユーザ応答データ数が多い場合、当該構成要素は、１秒以内にユーザの要求に応答するオンラインシステムとは別のオフライン環境にある
 - <strong>オンライン学習器</strong> : 最新のユーザ応答データを使用してモデルを調整するために、リアルタイムで一部のモデルパラメータを継続的に更新する

---
## ユビキタス言語

<table>
    <tr>
        <th>用語</th>
        <th>説明</th>
    </tr>
    <tr>
        <td>アイテム</td>
        <td>サービス利用者に対して、推薦するオブジェクト</td>
    </tr>
    <tr>
        <td>ユーザー</td>
        <td>アイテムの受け手/サービスの利用者</td>
    </tr>
</table>

---
## ドメインモデル

<img src="imgs/ドメインモデル①.png">
<img src="imgs/ドメインモデル②.png">

 - オレンジ色のブロックは、値オブジェクトを意味し、水色のブロックはエンティティを意味する。
 - アイテム、ユーザーオブジェクトは、他のコンポーネントで管理しおり、変更があった場合は定期的に供給してもらうとする。

---
## ビジネスロジック
### 類似アイテム取得API(素性ベースレコメンド)
> アイテムtoアイテムレコメンド

<img src="imgs/ビジネスロジック/類似アイテム取得API.png">

### ユーザベースレコメンドAPI(協調フィルタリングレコメンド)
> ユーザtoアイテムレコメンド

<img src="imgs/ビジネスロジック/ユーザベースレコメンドAPI.png">

### スコアリングバッチ

<img src="imgs/ビジネスロジック/スコアリングバッチ.png">

----
## クラス図
### レコメンドAPIコンテキスト


### スコアリングバッチコンテキスト


---
## シーケンス図

